import React, { useState, useEffect, useRef } from "react";

type Participant = {
  id: string;
  name: string;
};

type WeddingStatus =
  | "Planning"
  | "Confirmed"
  | "Cancelled"
  | "Finished"
  | "Postponed";

type MealPricing = {
  basePrice: number;
  childDiscount: number; // percentage
  childAgeLimit: number;
  bulkThreshold: number;
  bulkPrice: number;
  bulkMaxGuests: number;
  reservePrice: number;
  reserveThreshold: number;
  reserveMaxGuests: number;
};

type WeddingData = {
  _id?: string;
  weddingName: string;
  weddingDate: string;
  startTime?: string;
  location?: string;
  addressDetails?: string;
  budget?: number;
  notes?: string;
  status: WeddingStatus;
  participants: Participant[];
  mealPricing?: MealPricing;
};

const initialWedding: WeddingData = {
  weddingName: "",
  weddingDate: "",
  startTime: "",
  location: "",
  addressDetails: "",
  budget: 0,
  notes: "",
  status: "Planning",
  participants: [],
  mealPricing: {
    basePrice: 0,
    childDiscount: 50,
    childAgeLimit: 12,
    bulkThreshold: 250,
    bulkPrice: 0,
    bulkMaxGuests: 300,
    reservePrice: 0,
    reserveThreshold: 300,
    reserveMaxGuests: 500
  }
};

export default function WeddingPage() {
  const [wedding, setWedding] = useState<WeddingData>(initialWedding);
  const [allUsers, setAllUsers] = useState<Participant[]>([]);
  const [selectedParticipantId, setSelectedParticipantId] = useState("");
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [mealCalculation, setMealCalculation] = useState({
    adultGuests: 0,
    childGuests: 0,
    totalGuests: 0,
    totalCost: 0,
    costPerPerson: 0
  });

  // Add state for guest counts by status
  const [guestCounts, setGuestCounts] = useState({
    confirmed: 0,
    maybe: 0,
    pending: 0,
    total: 0
  });

  // Add state for editing meal pricing
  const [isEditingMealPricing, setIsEditingMealPricing] = useState(false);

  // Add state for manual calculation
  const [manualCalculation, setManualCalculation] = useState({
    adultGuests: 0,
    childGuests: 0
  });

  // Add state for auto-saving indicator
  const [autoSaving, setAutoSaving] = useState(false);

  // Add ref for debounce timeout
  const saveTimeoutRef = useRef<NodeJS.Timeout | null>(null);

  useEffect(() => {
    async function fetchUsers() {
      try {
        const res = await fetch("/api/users");
        if (!res.ok) throw new Error(res.statusText);
        const users = await res.json();
        console.log("Fetched users:", users);
        setAllUsers(
          users.map((u: any) => ({
            id: u._id,
            name: `${u.firstName} ${u.lastName}`,
          }))
        );
        return users; // Return users for fetchWedding to use
      } catch (error) {
        console.error("◊©◊í◊ô◊ê◊î ◊ë◊©◊ú◊ô◊§◊™ ◊û◊©◊™◊û◊©◊ô◊ù", error);
        return [];
      }
    }

    async function fetchWedding(users: any[]) {
      const token = localStorage.getItem("token");
      if (!token) {
        console.log("No token found, skipping wedding fetch");
        setLoading(false);
        return;
      }

      try {
        console.log("Fetching wedding with token:", token.substring(0, 20) + "...");
        const res = await fetch("/api/weddings/owner", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        console.log("Wedding fetch response status:", res.status);

        if (res.status === 404) {
          console.log("No wedding found for user, setting initial state");
          setWedding(initialWedding);
          setLoading(false);
          return;
        }

        if (!res.ok) throw new Error("Failed to fetch wedding");

        const data = await res.json();
        console.log("Fetched wedding data:", JSON.stringify(data, null, 2));
        console.log("Meal pricing from server:", JSON.stringify(data.mealPricing, null, 2));

        // Convert date to string format for the input field
        const formattedDate = data.weddingDate 
          ? new Date(data.weddingDate).toISOString().split('T')[0]
          : "";
        
        console.log("Original weddingDate:", data.weddingDate);
        console.log("Formatted weddingDate:", formattedDate);

        // Handle participants - they come as ObjectIds from server
        const participants = (data.participants || []).map((p: any) => {
          console.log("Processing participant:", p);
          if (typeof p === "string") {
            // If it's just an ID string, find the user name
            const user = users.find((u: any) => u._id === p);
            console.log("Found user for string participant:", user);
            return { id: p, name: user ? `${user.firstName} ${user.lastName}` : "Unknown User" };
          } else if (p._id) {
            // If it's an object with _id
            const user = users.find((u: any) => u._id === p._id);
            console.log("Found user for object participant:", user);
            return { id: p._id, name: user ? `${user.firstName} ${user.lastName}` : p.name || "Unknown User" };
          }
          return { id: p.id || p, name: p.name || "Unknown User" };
        });

        console.log("Processed participants:", participants);

        const weddingData = { 
          ...data, 
          weddingDate: formattedDate,
          participants,
          mealPricing: data.mealPricing || initialWedding.mealPricing
        };
        
        console.log("Setting wedding data:", JSON.stringify(weddingData, null, 2));
        console.log("üçΩÔ∏è Meal pricing from server:", JSON.stringify(data.mealPricing, null, 2));
        console.log("üçΩÔ∏è Meal pricing after processing:", JSON.stringify(weddingData.mealPricing, null, 2));
        setWedding(weddingData);
      } catch (error) {
        console.error("◊©◊í◊ô◊ê◊î ◊ë◊©◊ú◊ô◊§◊™ ◊ê◊ô◊®◊ï◊¢", error);
      } finally {
        setLoading(false);
      }
    }

    // Execute in sequence: fetchUsers first, then fetchWedding
    fetchUsers().then(fetchWedding);
  }, []);

  // Fetch guest counts from guest list
  useEffect(() => {
    async function fetchGuestCounts() {
      const token = localStorage.getItem("token");
      if (!token) return;

      try {
        const res = await fetch("/api/guests", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        if (res.ok) {
          const guests = await res.json();
          const counts = {
            confirmed: guests.filter((g: any) => g.status === 'Confirmed').length,
            maybe: guests.filter((g: any) => g.status === 'Maybe').length,
            pending: guests.filter((g: any) => g.status === 'Pending').length,
            total: guests.length
          };
          setGuestCounts(counts);
          console.log('üë• Guest counts:', counts);
        }
      } catch (error) {
        console.error('Error fetching guest counts:', error);
      }
    }

    fetchGuestCounts();
  }, []);

  function handleInputChange(
    e: React.ChangeEvent<
      HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement
    >
  ) {
    const { name, value } = e.target;
    setWedding((prev) => ({
      ...prev,
      [name]: name === "budget" ? Number(value) : value,
    }));
  }

  function handleAddParticipant() {
    if (!selectedParticipantId) return;
    if (wedding.participants.some((p) => p.id === selectedParticipantId)) return;

    const participant = allUsers.find((u) => u.id === selectedParticipantId);
    if (!participant) return;

    setWedding((prev) => ({
      ...prev,
      participants: [...prev.participants, participant],
    }));
    setSelectedParticipantId("");
  }

  function handleRemoveParticipant(id: string) {
    setWedding((prev) => ({
      ...prev,
      participants: prev.participants.filter((p) => p.id !== id),
    }));
  }

  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    await saveWeddingData();
  }

  async function saveWeddingData() {
    setSaving(true);
    
    const currentUserRaw = localStorage.getItem("currentUser");
    const token = localStorage.getItem("token");
    const currentUser = currentUserRaw ? JSON.parse(currentUserRaw) : null;

    console.log("Submitting wedding form with current user:", currentUser);

    if (!currentUser || !currentUser._id) {
      alert("◊ú◊ê ◊û◊ñ◊ï◊î◊î ◊û◊©◊™◊û◊© ◊û◊ó◊ï◊ë◊®");
      setSaving(false);
      return;
    }

    const participantIds = wedding.participants.map((p) => p.id);
    if (!participantIds.includes(currentUser._id)) participantIds.push(currentUser._id);

    const weddingToSave = {
      weddingName: wedding.weddingName,
      weddingDate: wedding.weddingDate,
      startTime: wedding.startTime,
      location: wedding.location,
      addressDetails: wedding.addressDetails,
      budget: wedding.budget,
      notes: wedding.notes,
      status: wedding.status,
      ownerID: currentUser._id,
      participants: participantIds,
      mealPricing: wedding.mealPricing,
    };

    console.log("Saving wedding data:", JSON.stringify(weddingToSave, null, 2));
    console.log("Meal pricing data:", JSON.stringify(wedding.mealPricing, null, 2));
    console.log("Wedding ID for update:", wedding._id);
    console.log("üîç Wedding state before save:", JSON.stringify(wedding, null, 2));

    try {
      let res;
      if (wedding._id) {
        console.log("Updating existing wedding with ID:", wedding._id);
        res = await fetch(`/api/weddings/${wedding._id}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify(weddingToSave),
        });
      } else {
        console.log("Creating new wedding");
        res = await fetch("/api/weddings", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`,
          },
          body: JSON.stringify(weddingToSave),
        });
      }

      console.log("Response status:", res.status);
      console.log("Response headers:", Object.fromEntries(res.headers.entries()));

      if (!res.ok) {
        const text = await res.text();
        console.error("‚ùå ◊©◊í◊ô◊ê◊î ◊ë◊©◊û◊ô◊®◊™ ◊ê◊ô◊®◊ï◊¢:", text);
        alert("◊©◊í◊ô◊ê◊î ◊ë◊©◊û◊ô◊®◊™ ◊î◊ê◊ô◊®◊ï◊¢");
        return;
      }

      const saved = await res.json();
      console.log("‚úÖ ◊ê◊ô◊®◊ï◊¢ ◊†◊©◊û◊® ◊ë◊î◊¶◊ú◊ó◊î:", JSON.stringify(saved, null, 2));
      console.log("üçΩÔ∏è Meal pricing in response:", JSON.stringify(saved.mealPricing, null, 2));
      setWedding({ ...wedding, _id: saved._id });
      
      // Only show alert for manual saves, not auto-saves
      if (!autoSaving) {
        alert("◊î◊ê◊ô◊®◊ï◊¢ ◊†◊©◊û◊® ◊ë◊î◊¶◊ú◊ó◊î!");
      }
    } catch (error) {
      console.error("‚ùå ◊©◊í◊ô◊ê◊î ◊ë◊©◊û◊ô◊®◊™ ◊ê◊ô◊®◊ï◊¢:", error);
      if (!autoSaving) {
        alert("◊©◊í◊ô◊ê◊î ◊ë◊©◊û◊ô◊®◊™ ◊î◊ê◊ô◊®◊ï◊¢");
      }
    } finally {
      setSaving(false);
    }
  }

  function getStatusColor(status: WeddingStatus) {
    switch (status) {
      case 'Planning': return '#ff9800';
      case 'Confirmed': return '#4CAF50';
      case 'Cancelled': return '#f44336';
      case 'Finished': return '#2196F3';
      case 'Postponed': return '#9C27B0';
      default: return '#ddd';
    }
  }

  function getStatusText(status: WeddingStatus) {
    switch (status) {
      case 'Planning': return '◊û◊™◊õ◊†◊†◊ô◊ù';
      case 'Confirmed': return '◊û◊ê◊ï◊©◊®';
      case 'Cancelled': return '◊û◊ë◊ï◊ò◊ú';
      case 'Finished': return '◊î◊ï◊©◊ú◊ù';
      case 'Postponed': return '◊†◊ì◊ó◊î';
      default: return status;
    }
  }

  function handleMealPricingChange(field: keyof MealPricing, value: number) {
    console.log(`üîÑ Changing meal pricing ${field} to:`, value);
    console.log('üçΩÔ∏è Current mealPricing before change:', JSON.stringify(wedding.mealPricing, null, 2));
    
    setWedding(prev => {
      const newWedding = {
        ...prev,
        mealPricing: {
          ...prev.mealPricing!,
          [field]: value
        }
      };
      console.log('üçΩÔ∏è New wedding state after meal pricing change:', JSON.stringify(newWedding.mealPricing, null, 2));
      return newWedding;
    });

    // Clear existing timeout
    if (saveTimeoutRef.current) {
      clearTimeout(saveTimeoutRef.current);
    }

    // Set new timeout for auto-save
    saveTimeoutRef.current = setTimeout(() => {
      console.log('üíæ Auto-saving meal pricing changes...');
      console.log('üçΩÔ∏è Final mealPricing to save:', JSON.stringify(wedding.mealPricing, null, 2));
      setAutoSaving(true);
      saveWeddingData().finally(() => {
        setAutoSaving(false);
      });
    }, 2000); // 2 seconds delay
  }

  function calculateMealCost() {
    if (!wedding.mealPricing) return;

    const { basePrice, childDiscount, childAgeLimit, bulkThreshold, bulkPrice, bulkMaxGuests, reservePrice, reserveThreshold, reserveMaxGuests } = wedding.mealPricing;
    const { adultGuests, childGuests } = mealCalculation;
    const totalGuests = adultGuests + childGuests;

    // Calculate costs for each tier
    let totalCost = 0;
    let remainingGuests = totalGuests;

    // Base price tier (0 to bulkThreshold)
    const baseGuests = Math.min(remainingGuests, bulkThreshold);
    if (baseGuests > 0) {
      const baseCost = baseGuests * basePrice;
      totalCost += baseCost;
      remainingGuests -= baseGuests;
    }

    // Bulk price tier (bulkThreshold + 1 to bulkMaxGuests)
    if (remainingGuests > 0 && bulkPrice > 0) {
      const bulkGuests = Math.min(remainingGuests, bulkMaxGuests - bulkThreshold);
      if (bulkGuests > 0) {
        const bulkCost = bulkGuests * bulkPrice;
        totalCost += bulkCost;
        remainingGuests -= bulkGuests;
      }
    }

    // Reserve price tier (reserveThreshold and above)
    if (remainingGuests > 0 && reservePrice > 0) {
      const reserveGuests = remainingGuests;
      const reserveCost = reserveGuests * reservePrice;
      totalCost += reserveCost;
    }

    // Apply child discount
    const childCost = childGuests * (basePrice * (1 - childDiscount / 100));
    totalCost += childCost;

    const costPerPerson = totalGuests > 0 ? totalCost / totalGuests : 0;

    setMealCalculation(prev => ({
      ...prev,
      totalGuests,
      totalCost,
      costPerPerson
    }));
  }

  function handleGuestCountChange(type: 'adult' | 'child', value: number) {
    setMealCalculation(prev => ({
      ...prev,
      [type === 'adult' ? 'adultGuests' : 'childGuests']: value
    }));
  }

  // Recalculate when meal pricing or guest counts change
  useEffect(() => {
    calculateMealCost();
  }, [wedding.mealPricing, mealCalculation.adultGuests, mealCalculation.childGuests]);

  // Calculate meal costs by guest status
  function calculateMealCostByStatus() {
    if (!wedding.mealPricing) return {};

    const { basePrice, childDiscount, childAgeLimit, bulkThreshold, bulkPrice, bulkMaxGuests, reservePrice, reserveThreshold, reserveMaxGuests } = wedding.mealPricing;

    const calculateForCount = (count: number) => {
      let totalCost = 0;
      let remainingGuests = count;

      // Base price tier (0 to bulkThreshold)
      const baseGuests = Math.min(remainingGuests, bulkThreshold);
      if (baseGuests > 0) {
        const baseCost = baseGuests * basePrice;
        totalCost += baseCost;
        remainingGuests -= baseGuests;
      }

      // Bulk price tier (bulkThreshold + 1 to bulkMaxGuests)
      if (remainingGuests > 0 && bulkPrice > 0) {
        const bulkGuests = Math.min(remainingGuests, bulkMaxGuests - bulkThreshold);
        if (bulkGuests > 0) {
          const bulkCost = bulkGuests * bulkPrice;
          totalCost += bulkCost;
          remainingGuests -= bulkGuests;
        }
      }

      // Reserve price tier (reserveThreshold and above)
      if (remainingGuests > 0 && reservePrice > 0) {
        const reserveGuests = remainingGuests;
        totalCost += reserveGuests * reservePrice;
      }

      const costPerPerson = count > 0 ? totalCost / count : 0;
      return { totalCost, costPerPerson };
    };

    return {
      confirmed: calculateForCount(guestCounts.confirmed),
      maybe: calculateForCount(guestCounts.maybe),
      pending: calculateForCount(guestCounts.pending),
      total: calculateForCount(guestCounts.total)
    };
  }

  // Calculate meal cost for manual input
  function calculateManualMealCost() {
    if (!wedding.mealPricing) return { totalCost: 0, costPerPerson: 0, adultGuests: 0, childGuests: 0, totalGuests: 0 };

    const { basePrice, childDiscount, childAgeLimit, bulkThreshold, bulkPrice, bulkMaxGuests, reservePrice, reserveThreshold, reserveMaxGuests } = wedding.mealPricing;
    const { adultGuests, childGuests } = manualCalculation;
    const totalGuests = adultGuests + childGuests;

    let totalCost = 0;
    let remainingGuests = totalGuests;

    // Base price tier (0 to bulkThreshold)
    const baseGuests = Math.min(remainingGuests, bulkThreshold);
    if (baseGuests > 0) {
      const baseCost = baseGuests * basePrice;
      totalCost += baseCost;
      remainingGuests -= baseGuests;
    }

    // Bulk price tier (bulkThreshold + 1 to bulkMaxGuests)
    if (remainingGuests > 0 && bulkPrice > 0) {
      const bulkGuests = Math.min(remainingGuests, bulkMaxGuests - bulkThreshold);
      if (bulkGuests > 0) {
        const bulkCost = bulkGuests * bulkPrice;
        totalCost += bulkCost;
        remainingGuests -= bulkGuests;
      }
    }

    // Reserve price tier (reserveThreshold and above)
    if (remainingGuests > 0 && reservePrice > 0) {
      const reserveGuests = remainingGuests;
      totalCost += reserveGuests * reservePrice;
    }

    // Apply child discount
    const childCost = childGuests * (basePrice * (1 - childDiscount / 100));
    totalCost += childCost;

    const costPerPerson = totalGuests > 0 ? totalCost / totalGuests : 0;

    return { totalCost, costPerPerson, adultGuests, childGuests, totalGuests };
  }

  if (loading) {
    return (
      <div style={{ textAlign: 'center', padding: '50px' }}>
        <div>◊ò◊ï◊¢◊ü...</div>
      </div>
    );
  }

  return (
    <div style={{ 
      padding: '20px', 
      maxWidth: '1200px', 
      margin: '0 auto',
      fontFamily: 'Arial, sans-serif',
      direction: 'rtl'
    }}>
      <style>
        {`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `}
      </style>
      
      <h1 style={{ 
        textAlign: 'center', 
        marginBottom: '30px',
        color: '#333',
        borderBottom: '2px solid #ddd',
        paddingBottom: '10px'
      }}>
        ◊î◊ê◊ô◊®◊ï◊¢ ◊©◊ú◊†◊ï
      </h1>

      {/* Help Section */}
      <div style={{
        background: '#e3f2fd',
        padding: '15px',
        borderRadius: '8px',
        marginBottom: '20px',
        border: '1px solid #2196F3'
      }}>
        <h4 style={{ margin: '0 0 10px 0', color: '#1976d2' }}>üí° ◊ê◊ô◊ö ◊ú◊†◊î◊ú ◊ê◊™ ◊î◊ê◊ô◊®◊ï◊¢:</h4>
        <div style={{ fontSize: '14px', lineHeight: '1.5', color: '#333' }}>
          <div><strong>◊§◊®◊ò◊ô ◊î◊ê◊ô◊®◊ï◊¢:</strong> ◊û◊ú◊ê ◊ê◊™ ◊õ◊ú ◊î◊§◊®◊ò◊ô◊ù ◊î◊ó◊©◊ï◊ë◊ô◊ù ◊¢◊ú ◊î◊ê◊ô◊®◊ï◊¢</div>
          <div><strong>◊©◊ï◊™◊§◊ô◊ù:</strong> ◊î◊ï◊°◊£ ◊©◊ï◊™◊§◊ô◊ù ◊ú◊ê◊ô◊®◊ï◊¢ ◊©◊ô◊ï◊õ◊ú◊ï ◊ú◊†◊î◊ú ◊ô◊ó◊ì ◊ê◊ô◊™◊ö</div>
          <div><strong>◊°◊ò◊ò◊ï◊°:</strong> ◊¢◊ì◊õ◊ü ◊ê◊™ ◊î◊°◊ò◊ò◊ï◊° ◊ú◊§◊ô ◊î◊™◊ß◊ì◊û◊ï◊™ ◊î◊™◊õ◊†◊ï◊ü</div>
          <div><strong>◊™◊ß◊¶◊ô◊ë:</strong> ◊î◊í◊ì◊® ◊™◊ß◊¶◊ô◊ë ◊ú◊ê◊ô◊®◊ï◊¢ ◊ú◊†◊ô◊î◊ï◊ú ◊î◊ï◊¶◊ê◊ï◊™</div>
        </div>
      </div>

      {/* Wedding Form */}
      <div style={{
        background: '#f9f9f9',
        padding: '20px',
        borderRadius: '8px',
        marginBottom: '30px',
        border: '1px solid #ddd'
      }}>
        <h3 style={{ marginTop: 0, marginBottom: '20px' }}>◊§◊®◊ò◊ô ◊î◊ê◊ô◊®◊ï◊¢</h3>
        <form onSubmit={handleSubmit}>
          <div style={{ display: 'grid', gap: '15px', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊©◊ù ◊î◊ê◊ô◊®◊ï◊¢ *
              </label>
              <input
                name="weddingName"
                value={wedding.weddingName}
                onChange={handleInputChange}
              
                required
                style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊™◊ê◊®◊ô◊ö ◊î◊ê◊ô◊®◊ï◊¢ *
              </label>
              <input
                name="weddingDate"
                type="date"
                value={wedding.weddingDate}
                onChange={handleInputChange}
                required
                style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊©◊¢◊™ ◊î◊™◊ó◊ú◊î
              </label>
              <input
                name="startTime"
                type="time"
                value={wedding.startTime}
                onChange={handleInputChange}
                style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊û◊ô◊ß◊ï◊ù
              </label>
              <input
                name="location"
                value={wedding.location}
                onChange={handleInputChange}
               
                style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊™◊ß◊¶◊ô◊ë (‚Ç™)
              </label>
              <input
                name="budget"
                type="number"
                min={0}
                value={wedding.budget}
                onChange={handleInputChange}
               
                style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊°◊ò◊ò◊ï◊°
              </label>
              <select
                name="status"
                value={wedding.status}
                onChange={handleInputChange}
                style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}
              >
                <option value="Planning">◊û◊™◊õ◊†◊†◊ô◊ù</option>
                <option value="Confirmed">◊û◊ê◊ï◊©◊®</option>
                <option value="Cancelled">◊û◊ë◊ï◊ò◊ú</option>
                <option value="Finished">◊î◊ï◊©◊ú◊ù</option>
                <option value="Postponed">◊†◊ì◊ó◊î</option>
              </select>
            </div>
          </div>

          <div style={{ marginTop: '15px' }}>
            <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
              ◊§◊®◊ò◊ô◊ù ◊†◊ï◊°◊§◊ô◊ù ◊ú◊õ◊™◊ï◊ë◊™
            </label>
            <textarea
              name="addressDetails"
              value={wedding.addressDetails}
              onChange={handleInputChange}
              placeholder="◊§◊®◊ò◊ô◊ù ◊†◊ï◊°◊§◊ô◊ù ◊ú◊õ◊™◊ï◊ë◊™ ◊î◊ê◊ô◊®◊ï◊¢"
              rows={2}
              style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}
            />
          </div>

          <div style={{ marginTop: '15px' }}>
            <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
              ◊î◊¢◊®◊ï◊™
            </label>
            <textarea
              name="notes"
              value={wedding.notes}
              onChange={handleInputChange}
              placeholder="◊î◊¢◊®◊ï◊™ ◊†◊ï◊°◊§◊ï◊™ ◊¢◊ú ◊î◊ê◊ô◊®◊ï◊¢"
              rows={3}
              style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}
            />
          </div>

          {/* Participants Section */}
          <div style={{ marginTop: '20px', padding: '15px', background: '#f5f5f5', borderRadius: '4px' }}>
            <h4 style={{ margin: '0 0 15px 0' }}>◊©◊ï◊™◊§◊ô◊ù ◊ú◊ê◊ô◊®◊ï◊¢</h4>
            
            <div style={{ display: 'flex', gap: '10px', marginBottom: '15px', alignItems: 'center' }}>
              <select
                value={selectedParticipantId}
                onChange={(e) => setSelectedParticipantId(e.target.value)}
                style={{ 
                  flex: 1, 
                  padding: '8px', 
                  border: '1px solid #ddd', 
                  borderRadius: '4px' 
                }}
              >
                <option value="">◊ë◊ó◊® ◊©◊ï◊™◊£ ◊ú◊î◊ï◊°◊§◊î</option>
                {allUsers
                  .filter((u) => !wedding.participants.some((p) => p.id === u.id))
                  .map((u) => (
                    <option key={u.id} value={u.id}>
                      {u.name}
                    </option>
                  ))}
              </select>
              <button
                type="button"
                onClick={handleAddParticipant}
                disabled={!selectedParticipantId}
                style={{ 
                  padding: '8px 16px', 
                  border: '1px solid #2196F3', 
                  background: selectedParticipantId ? '#2196F3' : '#ccc',
                  color: 'white',
                  borderRadius: '4px',
                  cursor: selectedParticipantId ? 'pointer' : 'not-allowed'
                }}
              >
                ◊î◊ï◊°◊£ ◊©◊ï◊™◊£
              </button>
            </div>

            {wedding.participants.length > 0 ? (
              <div style={{ display: 'grid', gap: '8px' }}>
                {wedding.participants.map((p) => (
                  <div
                    key={p.id}
                    style={{
                      display: 'flex',
                      justifyContent: 'space-between',
                      alignItems: 'center',
                      padding: '8px 12px',
                      background: 'white',
                      borderRadius: '4px',
                      border: '1px solid #ddd'
                    }}
                  >
                    <span style={{ fontWeight: 'bold' }}>{p.name}</span>
                    <button
                      type="button"
                      onClick={() => handleRemoveParticipant(p.id)}
                      style={{ 
                        padding: '4px 8px', 
                        border: '1px solid #f44336', 
                        background: '#f44336',
                        color: 'white',
                        borderRadius: '4px',
                        cursor: 'pointer',
                        fontSize: '12px'
                      }}
                    >
                      ◊î◊°◊®
                    </button>
                  </div>
                ))}
              </div>
            ) : (
              <div style={{ textAlign: 'center', color: '#666', fontStyle: 'italic' }}>
                ◊ê◊ô◊ü ◊©◊ï◊™◊§◊ô◊ù ◊ú◊ê◊ô◊®◊ï◊¢ ◊¢◊ì◊ô◊ô◊ü
              </div>
            )}
          </div>

          <div style={{ marginTop: '20px', textAlign: 'center' }}>
            <button
              type="submit"
              disabled={saving}
              style={{
                padding: '12px 24px',
                backgroundColor: saving ? '#ccc' : '#4CAF50',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: saving ? 'not-allowed' : 'pointer',
                fontSize: '16px',
                fontWeight: 'bold'
              }}
            >
              {saving ? '◊©◊ï◊û◊®...' : '◊©◊û◊ï◊® ◊ê◊ô◊®◊ï◊¢'}
            </button>
          </div>
        </form>
      </div>

      {/* Meal Pricing Section */}
      <div style={{
        background: '#fff3e0',
        padding: '20px',
        borderRadius: '8px',
        marginBottom: '30px',
        border: '1px solid #ff9800'
      }}>
        <h3 style={{ margin: '0 0 20px 0', color: '#e65100' }}>
          üçΩÔ∏è ◊û◊ó◊ô◊®◊ô ◊û◊†◊ï◊™ - ◊ó◊ô◊©◊ï◊ë ◊¢◊ú◊ï◊ô◊ï◊™ ◊î◊ê◊ô◊®◊ï◊¢
        </h3>
        
        <div style={{ 
          background: '#fff', 
          padding: '15px', 
          borderRadius: '4px', 
          marginBottom: '20px',
          border: '1px solid #ddd'
        }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' }}>
            <h4 style={{ margin: '0', color: '#333' }}>◊î◊í◊ì◊®◊ï◊™ ◊û◊ó◊ô◊®◊ô◊ù</h4>
            <button
              type="button"
              onClick={() => setIsEditingMealPricing(!isEditingMealPricing)}
              style={{
                padding: '8px 16px',
                backgroundColor: isEditingMealPricing ? '#f44336' : '#4CAF50',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: 'pointer',
                fontSize: '14px',
                fontWeight: 'bold'
              }}
            >
              {isEditingMealPricing ? '‚ùå ◊ë◊ô◊ò◊ï◊ú ◊¢◊®◊ô◊õ◊î' : '‚úèÔ∏è ◊¢◊®◊ï◊ö ◊î◊í◊ì◊®◊ï◊™'}
            </button>
          </div>
          
          {/* Auto-saving indicator */}
          {autoSaving && (
            <div style={{ 
              marginBottom: '15px', 
              padding: '8px 12px', 
              background: '#e3f2fd', 
              borderRadius: '4px', 
              border: '1px solid #2196F3',
              display: 'flex',
              alignItems: 'center',
              gap: '8px'
            }}>
              <div style={{ 
                width: '12px', 
                height: '12px', 
                borderRadius: '50%', 
                border: '2px solid #2196F3', 
                borderTop: '2px solid transparent',
                animation: 'spin 1s linear infinite'
              }}></div>
              <span style={{ color: '#1976d2', fontSize: '14px', fontWeight: 'bold' }}>
                üíæ ◊©◊ï◊û◊® ◊©◊ô◊†◊ï◊ô◊ô◊ù ◊ê◊ï◊ò◊ï◊û◊ò◊ô◊™...
              </span>
            </div>
          )}
          
          <div style={{ 
            marginBottom: '15px', 
            padding: '8px 12px', 
            background: '#fff3e0', 
            borderRadius: '4px', 
            border: '1px solid #ff9800',
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center'
          }}>
            <div style={{ fontSize: '12px', color: '#e65100' }}>
              <strong>üí° ◊ò◊ô◊§:</strong> ◊î◊©◊ô◊†◊ï◊ô◊ô◊ù ◊†◊©◊û◊®◊ô◊ù ◊ê◊ï◊ò◊ï◊û◊ò◊ô◊™ ◊™◊ï◊ö 2 ◊©◊†◊ô◊ï◊™ ◊û◊î◊©◊ô◊†◊ï◊ô ◊î◊ê◊ó◊®◊ï◊ü
            </div>
            <button
              type="button"
              onClick={() => {
                console.log('üöÄ Immediate save clicked');
                setAutoSaving(true);
                saveWeddingData().finally(() => {
                  setAutoSaving(false);
                });
              }}
              disabled={saving}
              style={{
                padding: '6px 12px',
                backgroundColor: saving ? '#ccc' : '#ff9800',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: saving ? 'not-allowed' : 'pointer',
                fontSize: '12px',
                fontWeight: 'bold'
              }}
            >
              {saving ? '◊©◊ï◊û◊®...' : 'üíæ ◊©◊û◊ï◊® ◊¢◊õ◊©◊ô◊ï'}
            </button>
          </div>
          
          {!isEditingMealPricing && (
            <div style={{ 
              marginBottom: '15px', 
              padding: '10px 15px', 
              background: '#e8f5e8', 
              borderRadius: '4px', 
              border: '1px solid #4caf50',
              textAlign: 'center'
            }}>
              <div style={{ fontSize: '14px', color: '#2e7d32', fontWeight: 'bold' }}>
                üîí ◊î◊©◊ì◊ï◊™ ◊†◊¢◊ï◊ú◊ô◊ù ◊ú◊¢◊®◊ô◊õ◊î
              </div>
              <div style={{ fontSize: '12px', color: '#2e7d32', marginTop: '5px' }}>
                ◊ú◊ó◊• ◊¢◊ú "‚úèÔ∏è ◊¢◊®◊ï◊ö ◊î◊í◊ì◊®◊ï◊™" ◊õ◊ì◊ô ◊ú◊ê◊§◊©◊® ◊¢◊®◊ô◊õ◊î
              </div>
            </div>
          )}
          
          <div style={{ display: 'grid', gap: '15px', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊û◊ó◊ô◊® ◊û◊†◊î (‚Ç™)
              </label>
              <input
                type="number"
                min="0"
                value={wedding.mealPricing?.basePrice || 0}
                onChange={(e) => handleMealPricingChange('basePrice', Number(e.target.value))}
               
                disabled={!isEditingMealPricing}
                style={{ 
                  width: '100%', 
                  padding: '8px', 
                  border: '1px solid #ddd', 
                  borderRadius: '4px',
                  backgroundColor: isEditingMealPricing ? 'white' : '#f5f5f5',
                  cursor: isEditingMealPricing ? 'text' : 'not-allowed'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊û◊°◊§◊® ◊î◊™◊ó◊ô◊ô◊ë◊ï◊™ ◊ú◊û◊ó◊ô◊® ◊û◊†◊î
              </label>
              <input
                type="number"
                min="0"
                value={wedding.mealPricing?.bulkThreshold || 0}
                onChange={(e) => handleMealPricingChange('bulkThreshold', Number(e.target.value))}
               
                disabled={!isEditingMealPricing}
                style={{ 
                  width: '100%', 
                  padding: '8px', 
                  border: '1px solid #ddd', 
                  borderRadius: '4px',
                  backgroundColor: isEditingMealPricing ? 'white' : '#f5f5f5',
                  cursor: isEditingMealPricing ? 'text' : 'not-allowed'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊û◊ó◊ô◊® ◊û◊†◊î ◊û◊¢◊ú ◊ú◊î◊™◊ó◊ô◊ô◊ë◊ï◊™ (‚Ç™)
              </label>
              <input
                type="number"
                min="0"
                value={wedding.mealPricing?.bulkPrice || 0}
                onChange={(e) => handleMealPricingChange('bulkPrice', Number(e.target.value))}
              
                disabled={!isEditingMealPricing}
                style={{ 
                  width: '100%', 
                  padding: '8px', 
                  border: '1px solid #ddd', 
                  borderRadius: '4px',
                  backgroundColor: isEditingMealPricing ? 'white' : '#f5f5f5',
                  cursor: isEditingMealPricing ? 'text' : 'not-allowed'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊¢◊ì ◊ê◊ô◊ñ◊î ◊û◊°◊§◊® ◊û◊™◊ê◊§◊©◊®◊™ ◊î◊î◊†◊ó◊î
              </label>
              <input
                type="number"
                min="0"
                value={wedding.mealPricing?.bulkMaxGuests || 0}
                onChange={(e) => handleMealPricingChange('bulkMaxGuests', Number(e.target.value))}
           
                disabled={!isEditingMealPricing}
                style={{ 
                  width: '100%', 
                  padding: '8px', 
                  border: '1px solid #ddd', 
                  borderRadius: '4px',
                  backgroundColor: isEditingMealPricing ? 'white' : '#f5f5f5',
                  cursor: isEditingMealPricing ? 'text' : 'not-allowed'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊û◊ó◊ô◊® ◊û◊†◊î ◊ë◊®◊ñ◊®◊ë◊î (‚Ç™)
              </label>
              <input
                type="number"
                min="0"
                value={wedding.mealPricing?.reservePrice || 0}
                onChange={(e) => handleMealPricingChange('reservePrice', Number(e.target.value))}
             
                disabled={!isEditingMealPricing}
                style={{ 
                  width: '100%', 
                  padding: '8px', 
                  border: '1px solid #ddd', 
                  borderRadius: '4px',
                  backgroundColor: isEditingMealPricing ? 'white' : '#f5f5f5',
                  cursor: isEditingMealPricing ? 'text' : 'not-allowed'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊°◊£ ◊õ◊û◊ï◊™ ◊®◊ñ◊®◊ë◊î
              </label>
              <input
                type="number"
                min="0"
                value={wedding.mealPricing?.reserveThreshold || 0}
                onChange={(e) => handleMealPricingChange('reserveThreshold', Number(e.target.value))}
            
                disabled={!isEditingMealPricing}
                style={{ 
                  width: '100%', 
                  padding: '8px', 
                  border: '1px solid #ddd', 
                  borderRadius: '4px',
                  backgroundColor: isEditingMealPricing ? 'white' : '#f5f5f5',
                  cursor: isEditingMealPricing ? 'text' : 'not-allowed'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊¢◊ì ◊ê◊ô◊ñ◊î ◊û◊°◊§◊® ◊û◊™◊ê◊§◊©◊®◊™ ◊î◊®◊ñ◊®◊ë◊î
              </label>
              <input
                type="number"
                min="0"
                value={wedding.mealPricing?.reserveMaxGuests || 0}
                onChange={(e) => handleMealPricingChange('reserveMaxGuests', Number(e.target.value))}
              
                disabled={!isEditingMealPricing}
                style={{ 
                  width: '100%', 
                  padding: '8px', 
                  border: '1px solid #ddd', 
                  borderRadius: '4px',
                  backgroundColor: isEditingMealPricing ? 'white' : '#f5f5f5',
                  cursor: isEditingMealPricing ? 'text' : 'not-allowed'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊î◊†◊ó◊î ◊ú◊ô◊ú◊ì◊ô◊ù (%)
              </label>
              <input
                type="number"
                min="0"
                max="100"
                value={wedding.mealPricing?.childDiscount || 0}
                onChange={(e) => handleMealPricingChange('childDiscount', Number(e.target.value))}
             
                disabled={!isEditingMealPricing}
                style={{ 
                  width: '100%', 
                  padding: '8px', 
                  border: '1px solid #ddd', 
                  borderRadius: '4px',
                  backgroundColor: isEditingMealPricing ? 'white' : '#f5f5f5',
                  cursor: isEditingMealPricing ? 'text' : 'not-allowed'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊í◊ô◊ú ◊û◊ß◊°◊ô◊û◊ú◊ô ◊ú◊ô◊ú◊ì
              </label>
              <input
                type="number"
                min="0"
                value={wedding.mealPricing?.childAgeLimit || 0}
                onChange={(e) => handleMealPricingChange('childAgeLimit', Number(e.target.value))}
              
                disabled={!isEditingMealPricing}
                style={{ 
                  width: '100%', 
                  padding: '8px', 
                  border: '1px solid #ddd', 
                  borderRadius: '4px',
                  backgroundColor: isEditingMealPricing ? 'white' : '#f5f5f5',
                  cursor: isEditingMealPricing ? 'text' : 'not-allowed'
                }}
              />
            </div>
          </div>
        </div>



        {/* Guest Status Based Pricing */}
        <div style={{ 
          background: '#e3f2fd', 
          padding: '15px', 
          borderRadius: '4px',
          marginTop: '20px',
          border: '1px solid #2196F3'
        }}>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '15px' }}>
            <h4 style={{ margin: '0', color: '#1976d2' }}>üë• ◊û◊ó◊ô◊®◊ô ◊û◊†◊ï◊™ ◊ú◊§◊ô ◊°◊ò◊ò◊ï◊° ◊û◊ï◊ñ◊û◊†◊ô◊ù</h4>
            <button
              type="button"
              onClick={async () => {
                const token = localStorage.getItem("token");
                if (!token) return;

                try {
                  const res = await fetch("/api/guests", {
                    headers: {
                      Authorization: `Bearer ${token}`,
                    },
                  });

                  if (res.ok) {
                    const guests = await res.json();
                    const counts = {
                      confirmed: guests.filter((g: any) => g.status === 'Confirmed').length,
                      maybe: guests.filter((g: any) => g.status === 'Maybe').length,
                      pending: guests.filter((g: any) => g.status === 'Pending').length,
                      total: guests.length
                    };
                    setGuestCounts(counts);
                    console.log('üîÑ Refreshed guest counts:', counts);
                  }
                } catch (error) {
                  console.error('Error refreshing guest counts:', error);
                }
              }}
              style={{
                padding: '8px 16px',
                backgroundColor: '#2196F3',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: 'pointer',
                fontSize: '14px',
                fontWeight: 'bold'
              }}
            >
              üîÑ ◊®◊¢◊†◊ü ◊°◊§◊ô◊®◊™ ◊û◊ï◊ñ◊û◊†◊ô◊ù
            </button>
          </div>
          
          <div style={{ display: 'grid', gap: '15px', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))' }}>
            {/* Confirmed Guests */}
            <div style={{ 
              background: 'white', 
              padding: '15px', 
              borderRadius: '4px',
              border: '2px solid #4caf50'
            }}>
              <div style={{ display: 'flex', alignItems: 'center', marginBottom: '10px' }}>
                <div style={{ 
                  width: '12px', 
                  height: '12px', 
                  borderRadius: '50%', 
                  backgroundColor: '#4caf50', 
                  marginRight: '8px' 
                }}></div>
                <h5 style={{ margin: '0', color: '#4caf50', fontWeight: 'bold' }}>◊û◊ê◊©◊®◊ô ◊î◊í◊¢◊î</h5>
              </div>
              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333', marginBottom: '5px' }}>
                {guestCounts.confirmed}
              </div>
              <div style={{ fontSize: '14px', color: '#666', marginBottom: '10px' }}>◊û◊ï◊ñ◊û◊†◊ô◊ù</div>
              {calculateMealCostByStatus().confirmed?.totalCost && typeof calculateMealCostByStatus().confirmed?.totalCost === 'number' && (
                <>
                  <div style={{ fontSize: '16px', fontWeight: 'bold', color: '#4caf50' }}>
                    {calculateMealCostByStatus().confirmed?.totalCost?.toLocaleString?.() ?? 0} ‚Ç™
                  </div>
                  <div style={{ fontSize: '12px', color: '#666' }}>
                    {(calculateMealCostByStatus().confirmed?.costPerPerson ?? 0).toFixed(0)} ‚Ç™ ◊ú◊ê◊ô◊©
                  </div>
                </>
              )}
            </div>

            {/* Maybe Guests */}
            <div style={{ 
              background: 'white', 
              padding: '15px', 
              borderRadius: '4px',
              border: '2px solid #ff9800'
            }}>
              <div style={{ display: 'flex', alignItems: 'center', marginBottom: '10px' }}>
                <div style={{ 
                  width: '12px', 
                  height: '12px', 
                  borderRadius: '50%', 
                  backgroundColor: '#ff9800', 
                  marginRight: '8px' 
                }}></div>
                <h5 style={{ margin: '0', color: '#ff9800', fontWeight: 'bold' }}>◊û◊™◊ú◊ë◊ò◊ô◊ù</h5>
              </div>
              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333', marginBottom: '5px' }}>
                {guestCounts.maybe}
              </div>
              <div style={{ fontSize: '14px', color: '#666', marginBottom: '10px' }}>◊û◊ï◊ñ◊û◊†◊ô◊ù</div>
              {calculateMealCostByStatus().maybe?.totalCost && typeof calculateMealCostByStatus().maybe?.totalCost === 'number' && (
                <>
                  <div style={{ fontSize: '16px', fontWeight: 'bold', color: '#ff9800' }}>
                    {calculateMealCostByStatus().maybe?.totalCost?.toLocaleString?.() ?? 0} ‚Ç™
                  </div>
                  <div style={{ fontSize: '12px', color: '#666' }}>
                    {(calculateMealCostByStatus().maybe?.costPerPerson ?? 0).toFixed(0)} ‚Ç™ ◊ú◊ê◊ô◊©
                  </div>
                </>
              )}
            </div>

            {/* Pending Guests */}
            <div style={{ 
              background: 'white', 
              padding: '15px', 
              borderRadius: '4px',
              border: '2px solid #9e9e9e'
            }}>
              <div style={{ display: 'flex', alignItems: 'center', marginBottom: '10px' }}>
                <div style={{ 
                  width: '12px', 
                  height: '12px', 
                  borderRadius: '50%', 
                  backgroundColor: '#9e9e9e', 
                  marginRight: '8px' 
                }}></div>
                <h5 style={{ margin: '0', color: '#9e9e9e', fontWeight: 'bold' }}>◊û◊û◊™◊ô◊†◊ô◊ù ◊ú◊™◊©◊ï◊ë◊î</h5>
              </div>
              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333', marginBottom: '5px' }}>
                {guestCounts.pending}
              </div>
              <div style={{ fontSize: '14px', color: '#666', marginBottom: '10px' }}>◊û◊ï◊ñ◊û◊†◊ô◊ù</div>
              {calculateMealCostByStatus().pending?.totalCost && typeof calculateMealCostByStatus().pending?.totalCost === 'number' && (
                <>
                  <div style={{ fontSize: '16px', fontWeight: 'bold', color: '#9e9e9e' }}>
                    {calculateMealCostByStatus().pending?.totalCost?.toLocaleString?.() ?? 0} ‚Ç™
                  </div>
                  <div style={{ fontSize: '12px', color: '#666' }}>
                    {(calculateMealCostByStatus().pending?.costPerPerson ?? 0).toFixed(0)} ‚Ç™ ◊ú◊ê◊ô◊©
                  </div>
                </>
              )}
            </div>

            {/* Total */}
            <div style={{ 
              background: 'white', 
              padding: '15px', 
              borderRadius: '4px',
              border: '2px solid #2196F3'
            }}>
              <div style={{ display: 'flex', alignItems: 'center', marginBottom: '10px' }}>
                <div style={{ 
                  width: '12px', 
                  height: '12px', 
                  borderRadius: '50%', 
                  backgroundColor: '#2196F3', 
                  marginRight: '8px' 
                }}></div>
                <h5 style={{ margin: '0', color: '#2196F3', fontWeight: 'bold' }}>◊°◊î"◊õ</h5>
              </div>
              <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333', marginBottom: '5px' }}>
                {guestCounts.total}
              </div>
              <div style={{ fontSize: '14px', color: '#666', marginBottom: '10px' }}>◊û◊ï◊ñ◊û◊†◊ô◊ù</div>
              {calculateMealCostByStatus().total?.totalCost && typeof calculateMealCostByStatus().total?.totalCost === 'number' && (
                <>
                  <div style={{ fontSize: '16px', fontWeight: 'bold', color: '#2196F3' }}>
                    {calculateMealCostByStatus().total?.totalCost?.toLocaleString?.() ?? 0} ‚Ç™
                  </div>
                  <div style={{ fontSize: '12px', color: '#666' }}>
                    {(calculateMealCostByStatus().total?.costPerPerson ?? 0).toFixed(0)} ‚Ç™ ◊ú◊ê◊ô◊©
                  </div>
                </>
              )}
            </div>
          </div>

          {/* Total Meal Cost Summary */}
          {calculateMealCostByStatus().total?.totalCost && typeof calculateMealCostByStatus().total?.totalCost === 'number' && (
            <div style={{ 
              marginTop: '20px', 
              padding: '15px', 
              background: '#4caf50', 
              borderRadius: '8px',
              border: '2px solid #2e7d32',
              textAlign: 'center'
            }}>
              <h4 style={{ margin: '0 0 10px 0', color: 'white', fontSize: '18px' }}>
                üí∞ ◊°◊î"◊õ ◊¢◊ú◊ï◊™ ◊û◊†◊ï◊™ ◊ú◊õ◊ú ◊î◊û◊ï◊ñ◊û◊†◊ô◊ù
              </h4>
              <div style={{ fontSize: '32px', fontWeight: 'bold', color: 'white', marginBottom: '5px' }}>
                {calculateMealCostByStatus().total?.totalCost?.toLocaleString?.() ?? 0} ‚Ç™
              </div>
              <div style={{ fontSize: '14px', color: 'rgba(255,255,255,0.9)' }}>
                ◊û◊û◊ï◊¶◊¢: {(calculateMealCostByStatus().total?.costPerPerson ?? 0).toFixed(0)} ‚Ç™ ◊ú◊ê◊ô◊©
              </div>
            </div>
          )}

          <div style={{ marginTop: '15px', padding: '10px', background: 'white', borderRadius: '4px', fontSize: '12px', color: '#666' }}>
            <strong>◊î◊¢◊®◊î:</strong> ◊î◊û◊ó◊ô◊®◊ô◊ù ◊û◊ó◊ï◊©◊ë◊ô◊ù ◊ê◊ï◊ò◊ï◊û◊ò◊ô◊™ ◊ú◊§◊ô ◊û◊°◊§◊® ◊î◊û◊ï◊ñ◊û◊†◊ô◊ù ◊ë◊õ◊ú ◊°◊ò◊ò◊ï◊° ◊ï◊ô◊ï◊ë◊ê◊ï ◊û◊®◊©◊ô◊û◊™ ◊î◊û◊ï◊ñ◊û◊†◊ô◊ù
          </div>
        </div>

        {/* Save Meal Pricing Button */}
        <div style={{ marginTop: '20px', textAlign: 'center' }}>
          <button
            type="button"
            onClick={() => {
              console.log('üíæ Save button clicked');
              console.log('üçΩÔ∏è Current meal pricing before save:', JSON.stringify(wedding.mealPricing, null, 2));
              saveWeddingData();
            }}
            disabled={saving}
            style={{
              padding: '12px 24px',
              backgroundColor: saving ? '#ccc' : '#ff9800',
              color: 'white',
              border: 'none',
              borderRadius: '4px',
              cursor: saving ? 'not-allowed' : 'pointer',
              fontSize: '16px',
              fontWeight: 'bold'
            }}
          >
            {saving ? '◊©◊ï◊û◊®...' : 'üíæ ◊©◊û◊ï◊® ◊î◊í◊ì◊®◊ï◊™ ◊û◊ó◊ô◊®◊ô ◊û◊†◊ï◊™'}
          </button>
          <div style={{ marginTop: '8px', fontSize: '12px', color: '#666' }}>
            ◊©◊û◊ô◊®◊™ ◊î◊í◊ì◊®◊ï◊™ ◊û◊ó◊ô◊®◊ô ◊î◊û◊†◊ï◊™ ◊ô◊ó◊ì ◊¢◊ù ◊§◊®◊ò◊ô ◊î◊ê◊ô◊®◊ï◊¢
          </div>
        </div>
      </div>

      {/* Manual Calculation - Custom Estimation */}
      <div style={{ 
        background: '#fff3e0', 
        padding: '20px', 
        borderRadius: '8px',
        marginBottom: '30px',
        border: '1px solid #ff9800'
      }}>
        <h3 style={{ margin: '0 0 20px 0', color: '#e65100' }}>
          üßÆ ◊ó◊ô◊©◊ï◊ë ◊ô◊ì◊†◊ô - ◊ê◊ï◊û◊ì◊ü ◊û◊ï◊™◊ê◊ù ◊ê◊ô◊©◊ô◊™
        </h3>
        
        <div style={{ 
          background: 'white', 
          padding: '20px', 
          borderRadius: '8px',
          border: '1px solid #ddd',
          marginBottom: '20px'
        }}>
          <h4 style={{ margin: '0 0 15px 0', color: '#333' }}>◊î◊õ◊†◊° ◊û◊°◊§◊®◊ô ◊ê◊ï◊®◊ó◊ô◊ù ◊ú◊ë◊ì◊ô◊ß◊î</h4>
          
          <div style={{ display: 'grid', gap: '15px', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊û◊°◊§◊® ◊û◊ë◊ï◊í◊®◊ô◊ù
              </label>
              <input
                type="number"
                min="0"
                value={manualCalculation.adultGuests}
                onChange={(e) => setManualCalculation(prev => ({
                  ...prev,
                  adultGuests: Number(e.target.value)
                }))}
              
                style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold', color: '#333' }}>
                ◊û◊°◊§◊® ◊ô◊ú◊ì◊ô◊ù (◊¢◊ì ◊í◊ô◊ú {wedding.mealPricing?.childAgeLimit || 0})
              </label>
              <input
                type="number"
                min="0"
                value={manualCalculation.childGuests}
                onChange={(e) => setManualCalculation(prev => ({
                  ...prev,
                  childGuests: Number(e.target.value)
                }))}
            
                style={{ width: '100%', padding: '8px', border: '1px solid #ddd', borderRadius: '4px' }}
              />
            </div>
          </div>
        </div>

        {/* Manual Calculation Results */}
        {manualCalculation.adultGuests > 0 || manualCalculation.childGuests > 0 ? (
          <div style={{ 
            background: '#e8f5e8', 
            padding: '20px', 
            borderRadius: '8px',
            border: '1px solid #4caf50'
          }}>
            <h4 style={{ margin: '0 0 15px 0', color: '#2e7d32' }}>◊™◊ï◊¶◊ê◊ï◊™ ◊î◊ó◊ô◊©◊ï◊ë</h4>
            
            <div style={{ display: 'grid', gap: '15px', gridTemplateColumns: 'repeat(auto-fit, minmax(180px, 1fr))' }}>
              <div style={{ textAlign: 'center' }}>
                <div style={{ fontSize: '14px', color: '#666', marginBottom: '5px' }}>◊°◊î"◊õ ◊ê◊ï◊®◊ó◊ô◊ù</div>
                <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#333' }}>
                  {calculateManualMealCost().totalGuests}
                </div>
              </div>
              <div style={{ textAlign: 'center' }}>
                <div style={{ fontSize: '14px', color: '#666', marginBottom: '5px' }}>◊û◊ë◊ï◊í◊®◊ô◊ù</div>
                <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#333' }}>
                  {calculateManualMealCost().adultGuests}
                </div>
              </div>
              <div style={{ textAlign: 'center' }}>
                <div style={{ fontSize: '14px', color: '#666', marginBottom: '5px' }}>◊ô◊ú◊ì◊ô◊ù</div>
                <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#333' }}>
                  {calculateManualMealCost().childGuests}
                </div>
              </div>
              <div style={{ textAlign: 'center' }}>
                <div style={{ fontSize: '14px', color: '#666', marginBottom: '5px' }}>◊¢◊ú◊ï◊™ ◊û◊û◊ï◊¶◊¢◊™ ◊ú◊ê◊ô◊©</div>
                <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#333' }}>
                  {calculateManualMealCost().costPerPerson.toFixed(0)} ‚Ç™
                </div>
              </div>
              <div style={{ textAlign: 'center' }}>
                <div style={{ fontSize: '14px', color: '#666', marginBottom: '5px' }}>◊°◊î"◊õ ◊¢◊ú◊ï◊™ ◊û◊†◊ï◊™</div>
                <div style={{ fontSize: '24px', fontWeight: 'bold', color: '#2e7d32' }}>
                  {calculateManualMealCost().totalCost.toLocaleString()} ‚Ç™
                </div>
              </div>
            </div>

            {/* Detailed Breakdown */}
            {calculateManualMealCost().totalGuests > 0 && (
              <div style={{ marginTop: '15px', padding: '15px', background: 'white', borderRadius: '4px' }}>
                <div style={{ fontSize: '14px', fontWeight: 'bold', marginBottom: '10px', color: '#333' }}>
                  ◊§◊ô◊®◊ï◊ò ◊î◊ó◊ô◊©◊ï◊ë:
                </div>
                <div style={{ fontSize: '12px', lineHeight: '1.4', color: '#666' }}>
                  <div>‚Ä¢ ◊û◊ë◊ï◊í◊®◊ô◊ù: {calculateManualMealCost().adultGuests} √ó {wedding.mealPricing?.basePrice || 0} ‚Ç™ = {(calculateManualMealCost().adultGuests * (wedding.mealPricing?.basePrice || 0)).toLocaleString()} ‚Ç™</div>
                  <div>‚Ä¢ ◊ô◊ú◊ì◊ô◊ù: {calculateManualMealCost().childGuests} √ó {((wedding.mealPricing?.basePrice || 0) * (1 - (wedding.mealPricing?.childDiscount || 0) / 100)).toFixed(0)} ‚Ç™ = {(calculateManualMealCost().childGuests * ((wedding.mealPricing?.basePrice || 0) * (1 - (wedding.mealPricing?.childDiscount || 0) / 100))).toLocaleString()} ‚Ç™</div>
                  {wedding.mealPricing && calculateManualMealCost().totalGuests >= (wedding.mealPricing?.bulkThreshold || 0) && (wedding.mealPricing?.bulkPrice || 0) > 0 && (
                    <div style={{ color: '#4caf50', fontWeight: 'bold' }}>
                      ‚úì ◊û◊ó◊ô◊® ◊î◊™◊ó◊ô◊ô◊ë◊ï◊™ ◊û◊ô◊ï◊©◊ù (◊û◊¢◊ú {wedding.mealPricing?.bulkThreshold || 0} ◊ê◊ï◊®◊ó◊ô◊ù)
                    </div>
                  )}
                  {wedding.mealPricing && calculateManualMealCost().totalGuests >= (wedding.mealPricing?.reserveThreshold || 0) && (wedding.mealPricing?.reservePrice || 0) > 0 && (
                    <div style={{ color: '#4caf50', fontWeight: 'bold' }}>
                      ‚úì ◊û◊ó◊ô◊® ◊®◊ñ◊®◊ë◊î ◊û◊ô◊ï◊©◊ù (◊û◊¢◊ú {wedding.mealPricing?.reserveThreshold || 0} ◊ê◊ï◊®◊ó◊ô◊ù)
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
        ) : (
          <div style={{ textAlign: 'center', color: '#666', fontStyle: 'italic' }}>
            ◊î◊õ◊†◊° ◊û◊°◊§◊®◊ô ◊ê◊ï◊®◊ó◊ô◊ù ◊õ◊ì◊ô ◊ú◊®◊ê◊ï◊™ ◊ê◊™ ◊î◊ó◊ô◊©◊ï◊ë
          </div>
        )}
      </div>

      {/* Wedding Summary */}
      {wedding.weddingName && (
        <div style={{
          background: 'white',
          padding: '20px',
          borderRadius: '8px',
          boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
          border: '1px solid #ddd'
        }}>
          <h3 style={{ margin: '0 0 20px 0', color: '#333', borderBottom: '1px solid #eee', paddingBottom: '10px' }}>
            üìã ◊°◊ô◊õ◊ï◊ù ◊î◊ê◊ô◊®◊ï◊¢
          </h3>
          
          <div style={{ display: 'grid', gap: '15px', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))' }}>
            <div>
              <strong style={{ color: '#666' }}>◊©◊ù ◊î◊ê◊ô◊®◊ï◊¢:</strong>
              <div style={{ marginTop: '5px', fontSize: '16px' }}>{wedding.weddingName}</div>
            </div>
            
            <div>
              <strong style={{ color: '#666' }}>◊™◊ê◊®◊ô◊ö ◊î◊ê◊ô◊®◊ï◊¢:</strong>
              <div style={{ marginTop: '5px', fontSize: '16px' }}>
                {wedding.weddingDate ? new Date(wedding.weddingDate).toLocaleDateString('he-IL') : '-'}
              </div>
            </div>
            
            <div>
              <strong style={{ color: '#666' }}>◊©◊¢◊™ ◊î◊™◊ó◊ú◊î:</strong>
              <div style={{ marginTop: '5px', fontSize: '16px' }}>{wedding.startTime || '-'}</div>
            </div>
            
            <div>
              <strong style={{ color: '#666' }}>◊û◊ô◊ß◊ï◊ù:</strong>
              <div style={{ marginTop: '5px', fontSize: '16px' }}>{wedding.location || '-'}</div>
            </div>
            
            <div>
              <strong style={{ color: '#666' }}>◊™◊ß◊¶◊ô◊ë:</strong>
              <div style={{ marginTop: '5px', fontSize: '16px' }}>
                {wedding.budget ? `${wedding.budget.toLocaleString()} ‚Ç™` : '-'}
              </div>
            </div>
            
            <div>
              <strong style={{ color: '#666' }}>◊°◊ò◊ò◊ï◊°:</strong>
              <div style={{ marginTop: '5px' }}>
                <span style={{
                  padding: '4px 8px',
                  borderRadius: '4px',
                  backgroundColor: getStatusColor(wedding.status),
                  color: 'white',
                  fontSize: '12px',
                  fontWeight: 'bold'
                }}>
                  {getStatusText(wedding.status)}
                </span>
              </div>
            </div>
          </div>
          
          {wedding.addressDetails && (
            <div style={{ marginTop: '15px' }}>
              <strong style={{ color: '#666' }}>◊§◊®◊ò◊ô◊ù ◊†◊ï◊°◊§◊ô◊ù ◊ú◊õ◊™◊ï◊ë◊™:</strong>
              <div style={{ marginTop: '5px', fontSize: '16px' }}>{wedding.addressDetails}</div>
            </div>
          )}
          
          {wedding.notes && (
            <div style={{ marginTop: '15px' }}>
              <strong style={{ color: '#666' }}>◊î◊¢◊®◊ï◊™:</strong>
              <div style={{ marginTop: '5px', fontSize: '16px' }}>{wedding.notes}</div>
            </div>
          )}
          
          <div style={{ marginTop: '15px' }}>
            <strong style={{ color: '#666' }}>◊©◊ï◊™◊§◊ô◊ù ◊ú◊ê◊ô◊®◊ï◊¢:</strong>
            <div style={{ marginTop: '5px' }}>
              {wedding.participants.length > 0 ? (
                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                  {wedding.participants.map((p) => (
                    <span
                      key={p.id}
                      style={{
                        padding: '4px 8px',
                        background: '#e3f2fd',
                        borderRadius: '4px',
                        fontSize: '14px',
                        border: '1px solid #2196F3'
                      }}
                    >
                      {p.name}
                    </span>
                  ))}
                </div>
              ) : (
                <div style={{ color: '#666', fontStyle: 'italic' }}>◊ê◊ô◊ü ◊©◊ï◊™◊§◊ô◊ù ◊ú◊ê◊ô◊®◊ï◊¢</div>
              )}
            </div>
          </div>

          {/* Meal Pricing Summary */}
          {wedding.mealPricing && (
            <div style={{ marginTop: '20px', padding: '15px', background: '#fff3e0', borderRadius: '4px', border: '1px solid #ff9800' }}>
              <h4 style={{ margin: '0 0 15px 0', color: '#e65100' }}>üçΩÔ∏è ◊¢◊ú◊ï◊ô◊ï◊™ ◊û◊†◊ï◊™</h4>
              
              {/* Basic Pricing */}
              <div style={{ marginBottom: '15px' }}>
                <h5 style={{ margin: '0 0 10px 0', color: '#e65100', fontSize: '14px' }}>◊û◊ó◊ô◊®◊ô◊ù ◊ë◊°◊ô◊°◊ô◊ô◊ù</h5>
                <div style={{ display: 'grid', gap: '8px', gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))' }}>
                  <div>
                    <strong style={{ color: '#666', fontSize: '12px' }}>◊û◊ó◊ô◊® ◊û◊†◊î</strong>
                    <div style={{ marginTop: '2px', fontSize: '14px' }}>{wedding.mealPricing.basePrice.toLocaleString()} ‚Ç™</div>
                  </div>
                  <div>
                    <strong style={{ color: '#666', fontSize: '12px' }}>◊î◊†◊ó◊î ◊ú◊ô◊ú◊ì◊ô◊ù</strong>
                    <div style={{ marginTop: '2px', fontSize: '14px' }}>{wedding.mealPricing.childDiscount}%</div>
                  </div>
                  <div>
                    <strong style={{ color: '#666', fontSize: '12px' }}>◊í◊ô◊ú ◊û◊ß◊°◊ô◊û◊ú◊ô ◊ú◊ô◊ú◊ì</strong>
                    <div style={{ marginTop: '2px', fontSize: '14px' }}>{wedding.mealPricing.childAgeLimit}</div>
                  </div>
                </div>
              </div>

              {/* Bulk Pricing */}
              {wedding.mealPricing.bulkPrice > 0 && (
                <div style={{ marginBottom: '15px' }}>
                  <h5 style={{ margin: '0 0 10px 0', color: '#e65100', fontSize: '14px' }}>◊û◊ó◊ô◊®◊ô ◊î◊™◊ó◊ô◊ô◊ë◊ï◊™</h5>
                  <div style={{ display: 'grid', gap: '8px', gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))' }}>
                    <div>
                      <strong style={{ color: '#666', fontSize: '12px' }}>◊û◊°◊§◊® ◊î◊™◊ó◊ô◊ô◊ë◊ï◊™</strong>
                      <div style={{ marginTop: '2px', fontSize: '14px' }}>{wedding.mealPricing.bulkThreshold}</div>
                    </div>
                    <div>
                      <strong style={{ color: '#666', fontSize: '12px' }}>◊û◊ó◊ô◊® ◊û◊†◊î ◊û◊¢◊ú ◊î◊™◊ó◊ô◊ô◊ë◊ï◊™</strong>
                      <div style={{ marginTop: '2px', fontSize: '14px' }}>{wedding.mealPricing.bulkPrice.toLocaleString()} ‚Ç™</div>
                    </div>
                    <div>
                      <strong style={{ color: '#666', fontSize: '12px' }}>◊¢◊ì ◊ê◊ô◊ñ◊î ◊û◊°◊§◊®</strong>
                      <div style={{ marginTop: '2px', fontSize: '14px' }}>{wedding.mealPricing.bulkMaxGuests}</div>
                    </div>
                  </div>
                </div>
              )}

              {/* Reserve Pricing */}
              {wedding.mealPricing.reservePrice > 0 && (
                <div style={{ marginBottom: '15px' }}>
                  <h5 style={{ margin: '0 0 10px 0', color: '#e65100', fontSize: '14px' }}>◊û◊ó◊ô◊®◊ô ◊®◊ñ◊®◊ë◊î</h5>
                  <div style={{ display: 'grid', gap: '8px', gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))' }}>
                    <div>
                      <strong style={{ color: '#666', fontSize: '12px' }}>◊°◊£ ◊õ◊û◊ï◊™ ◊®◊ñ◊®◊ë◊î</strong>
                      <div style={{ marginTop: '2px', fontSize: '14px' }}>{wedding.mealPricing.reserveThreshold}</div>
                    </div>
                    <div>
                      <strong style={{ color: '#666', fontSize: '12px' }}>◊û◊ó◊ô◊® ◊û◊†◊î ◊ë◊®◊ñ◊®◊ë◊î</strong>
                      <div style={{ marginTop: '2px', fontSize: '14px' }}>{wedding.mealPricing.reservePrice.toLocaleString()} ‚Ç™</div>
                    </div>
                    <div>
                      <strong style={{ color: '#666', fontSize: '12px' }}>◊¢◊ì ◊ê◊ô◊ñ◊î ◊û◊°◊§◊®</strong>
                      <div style={{ marginTop: '2px', fontSize: '14px' }}>{wedding.mealPricing.reserveMaxGuests}</div>
                    </div>
                  </div>
                </div>
              )}

              {/* Calculation Results */}
              {mealCalculation.totalCost > 0 && (
                <div style={{ marginTop: '15px', padding: '10px', background: '#e8f5e8', borderRadius: '4px', border: '1px solid #4caf50' }}>
                  <h5 style={{ margin: '0 0 10px 0', color: '#2e7d32', fontSize: '14px' }}>◊™◊ï◊¶◊ê◊ï◊™ ◊î◊ó◊ô◊©◊ï◊ë</h5>
                  <div style={{ display: 'grid', gap: '8px', gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))' }}>
                    <div>
                      <strong style={{ color: '#666', fontSize: '12px' }}>◊°◊î"◊õ ◊ê◊ï◊®◊ó◊ô◊ù</strong>
                      <div style={{ marginTop: '2px', fontSize: '14px' }}>{mealCalculation.totalGuests}</div>
                    </div>
                    <div>
                      <strong style={{ color: '#666', fontSize: '12px' }}>◊ê◊ï◊®◊ó◊ô◊ù ◊ë◊ï◊í◊®◊ô◊ù</strong>
                      <div style={{ marginTop: '2px', fontSize: '14px' }}>{mealCalculation.adultGuests}</div>
                    </div>
                    <div>
                      <strong style={{ color: '#666', fontSize: '12px' }}>◊ô◊ú◊ì◊ô◊ù</strong>
                      <div style={{ marginTop: '2px', fontSize: '14px' }}>{mealCalculation.childGuests}</div>
                    </div>
                    <div>
                      <strong style={{ color: '#666', fontSize: '12px' }}>◊û◊ó◊ô◊® ◊û◊†◊î ◊ê◊§◊ß◊ò◊ô◊ë◊ô</strong>
                      <div style={{ marginTop: '2px', fontSize: '14px' }}>{mealCalculation.costPerPerson.toFixed(0)} ‚Ç™</div>
                    </div>
                    <div>
                      <strong style={{ color: '#666', fontSize: '12px' }}>◊°◊î"◊õ ◊¢◊ú◊ï◊™ ◊û◊†◊ï◊™</strong>
                      <div style={{ marginTop: '2px', fontSize: '14px', fontWeight: 'bold', color: '#2e7d32' }}>
                        {mealCalculation.totalCost.toLocaleString()} ‚Ç™
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          )}
        </div>
      )}
    </div>
  );
}

